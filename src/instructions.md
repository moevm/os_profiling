# **Instructions**

> Для выполнения следующих шагов необходим `Docker`!

Необходимо клонировать ветку `PB-33`, либо перейти в неё, если репозиторий уже клонирован. Это можно выполнить следующими командами:
```
git clone https://github.com/moevm/os_profiling.git -b PB-33
```
```
git checkout PB-33
git pull 
```
Все дальнейшие шаги происходят в директории `<image_name>-build`.
Тут и далее `image_name` может принимать только одно из следующих значений: `yocto`, `buildroot`.

- ### **Yocto**
    1. Чтобы создать образ требудется запустить скрипт `create_image.sh` командой:
        ```
        ./create_image.sh <version>
        ```
        Значение аргумента `<version>` по умолчанию -- `unselected`.
        
        **В данный момент скрипт не поддерживает возможное существование нескольких образов соответсвующих паттерну. Данная особенность предусмотрена так, что для пересборки образа можно (нужно) запускать скрипт повторно. Поэтому перед запуском убедитесь, что у Вас нет образов с названиями подходящими под паттерн.**
    
    2.  После удачной сборки образа, можно запустить контейнер с помощью скрипта `run_container.sh`:
        ```
        ./run_container.sh
        ```
        **Важно, что скрипт запускает образ, название которого соответсвует паттерну из прошлого шага.**
    
    3. Как только контейнер будет запущен, будет предоставлен доступ к его файловой системе. Это можно понять по идентификатору пользователя, он будет выглядить так: `<image_name>_user@<container_id>`. Тут же можно найти директорию `assembly`, тут будут храниться данные/файлы с хоста -- volume.
        Полный путь директории `/home/<image_name>_user/project/assembly`.
    
        **Все последующие шаги происходят в директории `assembly` внутри контейнера.**
    
    4. Для того, чтобы запустить сборку/пересборку образа необходимо запустить скрипт `building.sh`:
        ```
        ./building.sh
        ```
        Все файлы сборки находятся в появившейся директории `build`. 
        
        Запуск образа `Yocto` происходит с помощью скрипта `up_yocto.sh`:
        ```
        ./up_yocto.sh
        ```
        Для авторизации в системе необходимо указать `login`, его значение `root`.
        Выход из системы осуществляется 2 способами:
        - `Ctrl + A`, + `X`
        - `Ctrl + A`, + `C`, + type `quit`
    
    5. Чтобы выйти из контейнера можно использовать сочетание клавиш `Ctrl + D` в терминале.
       
- ### **Buildroot**
    1. Чтобы создать образ требудется запустить скрипт `create_image.sh` командой:
        ```
        ./create_image.sh <version>
        ```
        Значение аргумента `<version>` по умолчанию -- `unselected`.
        
        **В данный момент скрипт не поддерживает возможное существование нескольких образов соответсвующих паттерну. Данная особенность предусмотрена так, что для пересборки образа можно (нужно) запускать скрипт повторно. Поэтому перед запуском убедитесь, что у Вас нет образов с названиями подходящими под паттерн.**
    
    2.  После удачной сборки образа, можно запустить контейнер с помощью скрипта `run_container.sh`:
        ```
        ./run_container.sh
        ```
        **Важно, что скрипт запускает образ, название которого соответсвует паттерну из прошлого шага.**
    
    3. Как только контейнер будет запущен, будет предоставлен доступ к его файловой системе. Это можно понять по идентификатору пользователя, он будет выглядить так: `<image_name>_user@<container_id>`. Тут же можно найти директорию `assembly`, тут будут храниться данные/файлы с хоста -- volume.
        Полный путь директории `/home/<image_name>_user/project/assembly`.
    
        **Все последующие шаги происходят в директории `assembly` внутри контейнера.**
    
    4. Для того, чтобы запустить сборку образа необходимо запустить скрипт `building.sh`:
        ```
        ./building.sh
        ```
        Все файлы сборки находятся в появившейся директории `build`.
        
        В процессе сборки может быть обнаружена проблема при установке `host-attr 2.5.2`:
        ```
        >>> host-attr 2.5.2 Downloading
        wget --passive-ftp -nd -t 3 -O '/home/buildroot_user/project/assembly/build/build/.attr-2.5.2.tar.xz.El9AYZ/output' 'http://download.savannah.gnu.org/releases/attr/attr-2.5.2.tar.xz' 
        --2024-02-26 21:05:10--  http://download.savannah.gnu.org/releases/attr/attr-2.5.2.tar.xz
        Resolving download.savannah.gnu.org (download.savannah.gnu.org)... 209.51.188.200, 2001:470:142:5::200
        Connecting to download.savannah.gnu.org (download.savannah.gnu.org)|209.51.188.200|:80... connected.
        HTTP request sent, awaiting response... 302 Moved Temporarily
        Location: http://ftp.acc.umu.se/mirror/gnu.org/savannah/attr/attr-2.5.2.tar.xz [following]
        --2024-02-26 21:05:10--  http://ftp.acc.umu.se/mirror/gnu.org/savannah/attr/attr-2.5.2.tar.xz
        Resolving ftp.acc.umu.se (ftp.acc.umu.se)... 194.71.11.163, 194.71.11.173, 194.71.11.165, ...
        Connecting to ftp.acc.umu.se (ftp.acc.umu.se)|194.71.11.163|:80...
        ```
        В таком случае рекомендуется повторить попытку сборки через несколько часов.
         
        Запустить образ `Buildroot` не выйдёт, результатом сборки является файл -- `~/project/assembly/build/images/sdcard.img`.
        
    5. Чтобы выйти из контейра можно использовать сочетание клавиш `Ctrl + D` в терминале.

