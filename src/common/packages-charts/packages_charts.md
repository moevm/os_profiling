# Сопоставление информации о ресурсах к пакету

## Имеющиеся данные
Для сопоставления информации о ресурсах к пакету анализировались log-файлы, находящиеся в директории build/tmp/buildstats/<временная метка>/. В этой директории существуют каталоги для каждого пакета, участвующего в сборке. Каждый каталог содержит log-файлы do_configure, do_install, do_compile, etc..., формат которых был описан в yocto_buildstats.md: https://github.com/moevm/os_profiling/blob/denisova_olga_yocto_buildstats/wiki/yocto_buildstats.md.

Из этих данных мы можем получить следующие характеристики:
1) Elapsed time - затраченное время                                                  
2) utime - количество времени, в течение которого процесс был запланирован в пользовательском режиме                                            
3) stime - количество времени, в течение которого он был запланирован в режиме ядра                                                                       
4) cutime - время, в течение которого дочерние процессы были запланированы в пользовательском режиме
5) cstime - время, в течение которого они были запланированы в режиме ядра
6) IO rchar - количество байт, считанных из хранилища
7) IO read_bytes - количество байт, считанных из хранилища (это оценка, она точна для файловых систем с блочной поддержкой)                                               
8) IO wchar - количество байт, записанных на диск   
9) IO write_bytes - редполагаемое количество байт, записанных на уровень хранения (оценка)                                        
10) IO cancelled_write_bytes -  is the number of bytes written that did not happen, by truncating page cache (мне не особо ясно, что это)
11) IO syscr - предполагаемое количество I/O операций для чтения    
12) IO syscw -  предполагаемое количество I/O операций для записи
13) rusage ru_utime - используемое процессорное время в режиме пользователя в секундах                                                         
14) rusage ru_stime - используемое процессорное время в режиме ядра в секундах                                         
15) rusage ru_maxrss максимальный размер резидентного набора в КБ (резидентный набор - то, сколько памяти выделено данному процессу и находится в оперативной памяти. Он включает в себя всю память, к которой процесс может получить доступ, включая память, которая выгружается, память, которая выделена, но не используется, и память из общих библиотек)
16) rusage ru_minflt - общее количество незначительных ошибок, допущенных задачей в
секунду, тех, которые не требовали загрузки страницы памяти с диска.
17) rusage ru_majflt - общее количество серьезных ошибок, допущенных задачей за
секунду, тех, которые потребовали загрузки страницы памяти с диска.
18) rusage ru_inblock - количество операций блокового ввода                                                           
19) rusage ru_oublock - количество операций блокового вывода                          
20) rusage ru_nvcsw - количество переключений контекста в следствии добровольной отдачи процессом процессора до того, как истёк его рабочий временной интервал (обычно, из-за ожидания доступности ресурса).           
21) rusage ru_nivcsw - количество переключений контекста в следствии вытеснения процессом с более высоким приоритетом или из-за истечения рабочего временного интервала процесса.                              
22) Child rusage ru_utime - то же, что и пункт 2, но для всех наследников процесса                                    
23) Child rusage ru_stime - то же, что и пункт 3, но для всех наследников процесса                                                    
24) Child rusage ru_maxrss - то же, что и пункт 15, но для всех наследников процесса                                                     
25) Child rusage ru_minflt - то же, что и пункт 16, но для всех наследников процесса                                                  
26) Child rusage ru_majflt - то же, что и пункт 17, но для всех наследников процесса                                                     
27) Child rusage ru_inblock - то же, что и пункт 18, но для всех наследников процесса                                                   
28) Child rusage ru_oublock - то же, что и пункт 19, но для всех наследников процесса                                                  
29) Child rusage ru_nvcsw - то же, что и пункт 20, но для всех наследников процесса                                                      
30) Child rusage ru_nivcsw - то же, что и пункт 21, но для всех наследников процесса 


## Построение графиков использованных ресурсов

Была написана python-программа, которая отрисовывает графики в осях пакеты-ресурсы по заданным характеристикам.
На мой взгляд наиболее интересными характеристиками кажутся 'utime', 'stime', 'cutime', 'cstime', 'IO rchar', 'IO wchar', 'rusage ru_utime', 'rusage ru_stime', 'rusage ru_maxrss', 'Child rusage ru_utime', 'Child rusage ru_stime'.
Программа отрисовывает графики и сохраняет их в отдельные png-файлы.

По заданным характеристикам были построены графики, пример: 
![rusage ru_utime](https://github.com/moevm/os_profiling/assets/90854310/1d37013a-f817-43a9-876c-f306813b2d12)



Все графики находятся в каталоге charts.
Код программы для отрисовки графиков в файле make-charts.py.

## Сопоставление ресурсов на процессы
Директория build/tmp/work содержит рабочие подкаталоги, относящиеся к конкретной архитектуре. Данные подкаталоги содержат информацию о пакетах. В папке пакета в подкаталоге temp есть файлы журналов для каждой задачи (log.do_<тип задачи>.pid) и сценарии, которые BitBake запускает для каждой задачи (run.do_<тип задачи>.pid). Данные файлы создаются и заполняются в процессе сборки. В совокупности все пакеты из директории build/tmp/work соответствуют пакетам, имеющимся в папке статистики build/temp/buildstats, за исключением пакета gcc-source-13.2.0-13.2.0. Предположение в том, что по pid каждой задачи (который указан в конце названия log-файлов) мы можем сопоставить использованные ресурсы на процессы. Структура данной директории описывается здесь: https://docs.yoctoproject.org/ref-manual/structure.html, раздел 4.2.7.9.



