# **Instructions**
> Для образа потребуется не менее 80Gb памяти. Процесс сборки займёт более 2 часов.

> Для выполнения следующих шагов необходим `Docker` и `Docker compose v2`! Проверить соответствующие зависимости можно с помощью скрипта `/src/docker-check.sh`.

Необходимо клонировать репозиторий. Это можно выполнить следующей командой:
```
git clone https://github.com/moevm/os_profiling.git
```
Все дальнейшие шаги происходят в директории `<image_name>-build`.
Тут и далее `image_name` может принимать только одно из следующих значений: `yocto`, `buildroot`.

- ### **Yocto**
    1. Чтобы создать образ требуется выполнить команду:
        ```
        docker compose build --build-arg UID=$(id -u) --build-arg GID=$(id -g) --build-arg CORE=$(uname -r) --build-arg CODENAME=$(cat /etc/lsb-release | grep CODENAME | cut -d = -f 2)
        ```
    
    2.  После удачной сборки образа, можно запустить контейнер командой:
        ```
        docker compose up
        ```
        Когда произоёдет автоматическое закрытие контейнра (с кодом 0) -- всё будет установлено. 
       
- ### **Запуск**
        
    1. Запуск контейнера с нужными параметрами с помощью скрипта `run_container.sh`:
        ```
        ./run_container.sh
        ```
        Этот скрипт выполнит запуск с нужными переменными среды и даст доступ к файловой системе контейнера, это и позволит запустить собранный образ.
        
    2. Запуск образа `yocto_project`:
        После получения доступа к файловой системе контейнера необходимо выполнить скрипт `up_yocto.sh` в текущей директории:
        ```
        ./up_yocto.sh
        ```
        Поздравляю, Вы получили доступ к дистрибутиву **Yocto**.

- ### **Работа с Yocto**
    Для авторизации в системе необходимо указать `login`, его значение `root`.
    Выход из системы осуществляется 2 способами:
        - `Ctrl + A`, + `X`
        - `Ctrl + A`, + `C`, + type `quit`
        
- ### **Логирование**
    В данный момент логирование предусмотерно только для **Yocto**.
    В скрипте `building.sh` реализован декоратор для предоставления возможности настройки логирования. Скрипт находится по пути `./assembly/scripts/building.sh`. Важно, что все команды позволяющие использовать утилиты для логирования необходимо выполнять строго под `sudo`.
    
    Для того, чтобы настроить и использовать нужные утилиты объявлены функции `function start_logging()` и `function finish_logging()`. Функции позволяют задавать необходимую реализацию логирования. Также в функции перёдаётся аргумент (`$1`) -- файл для логирования по умолчанию (`./assembly/logs/building_logs.txt`).
    
