# **Instructions**
> Для образа потребуется не менее 90Gb памяти. Процесс сборки займёт более 2 часов.

> Для выполнения следующих шагов необходим `Docker` и `Docker compose v2`!

Необходимо клонировать репозиторий. Это можно выполнить следующей командой:
```
git clone https://github.com/moevm/os_profiling.git
```
Все дальнейшие шаги происходят в директории `src`.

- ### **Yocto**
    Для удобного взаимодействия был реализован скрипт `entrypoint.sh`, далее рассмотрим его функционал.
    1. Чтобы узнать какой функционал реализован в скрипте можно выполнить команду:
        ```
        ./entrypoint.sh
        ```
        
        После выполнения команды будет выведена информационная справка по использованию скрипта, то есть возможные аргументы и т.д.
    
    2. Чтобы проверить установку всех необходимых зависимостей локально требуется выполнить команду:
        ```
        ./entrypoint.sh check
        ```
        
        После выполнения команды произойдёт проверка всех необходимых зависимостей, для каждой из которых будет выведен статус, а далее общий результат.
        
    3. Чтобы создать образ среды для проекта требуется выполнить команду:
        ```
        ./entrypoint.sh build_env
        ```
        
        После выполнения команды начнётся сборка образа с помощью docker. 
        При необходимости можно отключить утилиту `perf`, для этого к предыдущей команде необходимо добавить флаг `--no-perf`. 
    
    4.  Чтобы получить доступ к файловой системе контейнера требуется выполнить команду:
        ```
        ./entrypoint.sh shell
        ```
        
        После выполнения команды будет запущен контейнер и открыт терминал. 
    
    5.  Чтобы собрать образ Yocto требуется выполнить команду:
        ```
        ./entrypoint.sh build_yocto_image
        ```
        
        После выполнения команды начнётся сборка образа `Yocto` внутри контейнера, когда произойдет автоматическое закрытие контейнера (с кодом 0) -- всё будет установлено. 
    
    6.  Чтобы запустить образ Yocto требуется выполнить команду:
        ```
        ./entrypoint.sh start_yocto
        ```
        
        После выполнения будет открыта авторизация в системе `Yocto`. Все действия дальее описаны ниже.

- ### **Работа с Yocto**
    Для авторизации в системе необходимо указать `login`, его значение `root`.
    Поздравляю, вы получили доступ к системе.
    Выход из системы осуществляется 2 способами:
    - `Ctrl + A`, + `X`
    - `Ctrl + A`, + `C`, + type `quit`
        
- ### **Логирование**
    В скрипте `building.sh` реализован декоратор для предоставления возможности настройки логирования. Скрипт находится по пути `./assembly/scripts/building.sh`. Важно, что все команды позволяющие использовать утилиты для логирования необходимо выполнять строго под `sudo`.
    
    Для того, чтобы настроить и использовать нужные утилиты объявлены функции `function start_logging()` и `function finish_logging()`. Функции позволяют задавать необходимую реализацию логирования. Также в функции перёдаётся аргумент (`$1`) -- файл для логирования по умолчанию (`./assembly/logs/building_logs.txt`).
    
