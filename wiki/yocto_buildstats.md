## Анализ статистики сборки

В катологе /build/tmp/buildstats находятся каталоги для каждого образа со статусом сборки в папке с меткой времени.

В ней существуют подкаталоги для каждого пакета в собранном образе и файл build_stats, содержащий:
 1. Информацию о хост-системе
 2. Расположение и размер корневой файловой системы
 3. Время создания
 4. Средняя загрузка процессора
 5. Статистика диска

 Например, проделанная мною сборка заняла 3535.9 секунд (~1 час), при этом загруженность процессора составила 79.3%.

Также в каталоге buildstats находятся файлы reduced_proc_meminfo.log, reduced_proc_diskstats.log, reduced_proc_stat.log, содержащие информацию об использовании RAM, памяти, процессора соответственно. 

Данные файлы соответствуют структуре:
- Время 1
- Метрики в момент времени 'время 1' ..... 


- Время 2
- Метрики в момент времени 'время 2'.....

Так, например,  файл reduced_proc_meminfo.log содержит следующие метрики соответственно:  'MemTotal', 'MemFree', 'Buffers', 'Cached', 'SwapTotal', 'SwapFree':

![image](https://github.com/moevm/os_profiling/assets/90854310/9af95970-91c4-416e-aa3c-9dde6f761781)

Также внутри buildstats существует каталог reduced_proc_pressure, в котором находятся аналогичные файлы о CPU_Pressure, MEM Pressure и I/O Pressure.

В каталогах, соответствующих пакетам, находятся файлы do_configure, do_install, do_compile, etc..., которые содержат данные о начале выполнения данной задаче, конце выполнения, статусе выполнение и прочие, см. пример:

![image](https://github.com/moevm/os_profiling/assets/90854310/29a233a1-ee12-4962-b441-c7fca2d38985)

## Структура файловой системы
Была создана диаграмма, отображающая ту часть файлового дерева проекта, которая содержит интересующую нас статистику:
![tmp_directory_structure](https://github.com/moevm/os_profiling/assets/90854310/19633b1b-3098-415f-97a4-8797da19caf7)

На диаграмме приведена расшифровка переменных, используемых в системе сборки, подробнее о них можно почитать здесь: https://docs.yoctoproject.org/dev/ref-manual/variables.html#term-PV

## Сопоставление пакетов из buildstats пакетам из work
Из диаграммы видно, что в buildstats пакеты указываются вместе с PV и PR, а в work нет, поэтому сопоставление происходит следующим образом: из названия в buildstats с конца убирается по одному символу, пока не будет найдено совпадение с названием из work.

## Каких данных нет/пробелы в данных
Посмотрев на диаграмму, можно увидеть что в buildstats и в work есть множества пакетов. Практически для всех пакетов из buildstats можно найти данные о PID в work, но <u>не для всех </u>. Также иногда не совпадают множества файлов задач (то есть, например, в buildstats в пакете example есть файл do_compile и информация по затраченным на эту задачу ресурсам, а в work в пакете example нет log-файла, соответсвующего log.do_compile.PID). Это является причиной того, что не для всех задач мы можем определить PID.


## Получение графиков сборки
 При помощи скрипта, находящегося в /poky/scripts/pybootchartgui/pybootchartgui.py и указания конкретной сборки по временной метке был построен график сборки (из директории build выполнялась команда `$../scripts/pybootchartgui/pybootchartgui.py tmp/buildstats/20240212085739/ -o ./`, был получен график bootchart.png в директории build):
 
![bootchart](https://github.com/moevm/os_profiling/assets/90854310/59c9e50f-2349-42f9-a422-f4ed831fedf3)


## Анализ графиков сборки
 Ось X данного графика соответствует времени сборки в секундах.
 Сверху находятся подграфики, отображающие
1. Нагрузку на процессор
2. Пропускную способность диска
3. Среднее CPU Pressure (это соотношение, измеряющееся в процентах, отслеживается как последние тенденции за десять, шестьдесят и триста секунд, что дает представление о краткосрочных событиях, а также о средне- и долгосрочных тенденциях - доля времени, в течение которой процессы на CPU останавливаются в ожидании "доступа" к CPU, информация берется из /proc/pressure/cpu)
4. Среднее I/O Pressure (то же самое, что и п.3, но в ожидании ввода-записи, информация берется из /proc/pressure/io)
5. Среднее MEM Pressure (то же самое, что и п.3, но в ожидании получения памяти, информация берется из /proc/pressure/memory)
6. Нагрузка на файловую систему (процент занятой/незанятой памяти)
7. Нагрузка на RAM (в том числе процент, занимаемый кэшем и буфферами, а также график swap).


Далее идет временной график, отображающий выполнение каждой задачи. Для каждой задачи видно, когда она началась, когда закончилась, написано сколько секунд заняло выполнение, а также цветом обозначен тип задачи (конфигурирование/установка/компиляция и т.п.). Из графика можно понять, какие задачи выполнялись одновременно.
